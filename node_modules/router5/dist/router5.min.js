!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.router5={})}(this,function(e){"use strict";var _=function(){return(_=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},u={trailingSlashMode:"default",queryParamsMode:"default",strictTrailingSlash:!1,autoCleanUp:!0,allowNotFound:!1,strongMatching:!0,rewritePathOnMatch:!0,caseSensitive:!1};var y=function(e){return void 0===e&&(e={}),{arrayFormat:e.arrayFormat||"none",booleanFormat:e.booleanFormat||"none",nullFormat:e.nullFormat||"default"}},d=function(e){return encodeURIComponent(e)},f=function(e){return decodeURIComponent(e)},n=function(e,t,r){return null===t?(n=e,"hidden"===(a=r).nullFormat?"":"string"===a.nullFormat?n+"=null":n):"boolean"==typeof t?(i=e,o=t,"empty-true"===(u=r).booleanFormat&&o?i:i+"="+("unicode"===u.booleanFormat?o?"✓":"✗":o.toString())):Array.isArray(t)?(s=e,c=t,f="index"===(l=r).arrayFormat?function(e,t){return e+"["+t+"]"}:"brackets"===l.arrayFormat?function(e){return e+"[]"}:function(e){return e},c.map(function(e,t){return f(s,t)+"="+d(e)}).join("&")):e+"="+d(t);var n,a,i,o,u,s,c,l,f},T=function(e){var t=e.indexOf("?");return-1===t?e:e.slice(t+1)},S=function(e){var t=e.indexOf("["),r=-1!==t;return{hasBrackets:r,name:r?e.slice(0,t):e}},O=function(e,t){var l=y(t);return T(e).split("&").reduce(function(e,t){var r=t.split("="),n=r[0],a=r[1],i=S(n),o=i.hasBrackets,u=i.name,s=e[u],c=function(e,t){if(void 0===e)return"empty-true"===t.booleanFormat||null;if("string"===t.booleanFormat){if("true"===e)return!0;if("false"===e)return!1}else if("unicode"===t.booleanFormat){if("✓"===f(e))return!0;if("✗"===f(e))return!1}else if("string"===t.nullFormat&&"null"===e)return null;return f(e)}(a,l);return e[u]=void 0===s?o?[c]:c:[].concat(s,c),e},{})},m=function(t,e){var r=y(e);return Object.keys(t).filter(function(e){return void 0!==t[e]}).map(function(e){return n(e,t[e],r)}).filter(Boolean).join("&")},c=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},l=function(e){return"("+(e?e.replace(/(^<|>$)/g,""):"[a-zA-Z0-9-_.~%':|=+\\*@]+")+")"},t=[{name:"url-parameter",pattern:/^:([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,regex:function(e){return new RegExp(l(e[2]))}},{name:"url-parameter-splat",pattern:/^\*([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/,regex:/([^?]*)/},{name:"url-parameter-matrix",pattern:/^;([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,regex:function(e){return new RegExp(";"+e[1]+"="+l(e[2]))}},{name:"query-parameter",pattern:/^(?:\?|&)(?::)?([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/},{name:"delimiter",pattern:/^(\/|\?)/,regex:function(e){return new RegExp("\\"+e[0])}},{name:"sub-delimiter",pattern:/^(!|&|-|_|\.|;)/,regex:function(e){return new RegExp(e[0])}},{name:"fragment",pattern:/^([0-9a-zA-Z]+)/,regex:function(e){return new RegExp(e[0])}}],a=function(r,n){if(void 0===n&&(n=[]),!t.some(function(e){var t=r.match(e.pattern);return!!t&&(n.push({type:e.name,match:t[0],val:t.slice(1,2),otherVal:t.slice(2),regex:e.regex instanceof Function?e.regex(t):e.regex}),t[0].length<r.length&&(n=a(r.substr(t[0].length),n)),!0)}))throw new Error("Could not parse path '"+r+"'");return n},p=function(e){return e},h=function(e){return null!=e},s=function(){function t(e){if(!e)throw new Error("Missing path in Path constructor");this.path=e,this.tokens=a(e),this.hasUrlParams=0<this.tokens.filter(function(e){return/^url-parameter/.test(e.type)}).length,this.hasSpatParam=0<this.tokens.filter(function(e){return/splat$/.test(e.type)}).length,this.hasMatrixParams=0<this.tokens.filter(function(e){return/matrix$/.test(e.type)}).length,this.hasQueryParams=0<this.tokens.filter(function(e){return/^query-parameter/.test(e.type)}).length,this.spatParams=this.getParams("url-parameter-splat"),this.urlParams=this.getParams(/^url-parameter/),this.queryParams=this.getParams("query-parameter"),this.params=this.urlParams.concat(this.queryParams),this.source=this.tokens.filter(function(e){return void 0!==e.regex}).map(function(e){return e.regex.source}).join("")}return t.createPath=function(e){return new t(e)},t.prototype.isQueryParam=function(e){return-1!==this.queryParams.indexOf(e)},t.prototype.test=function(e,t){var r,n=this,a=c({strictTrailingSlash:!1,queryParams:{}},t),i=(r=this.source,a.strictTrailingSlash?r:"\\/"===r?r:r.replace(/\\\/$/,"")+"(?:\\/)?"),o=this.urlTest(e,i+(this.hasQueryParams?"(\\?.*$|$)":"$"),t);if(!o||!this.hasQueryParams)return o;var u=O(e,a.queryParams);return 0===Object.keys(u).filter(function(e){return!n.isQueryParam(e)}).length?(Object.keys(u).forEach(function(e){return o[e]=u[e]}),o):null},t.prototype.partialTest=function(e,t){var r,n=this,a=c({delimited:!0,queryParams:{}},t),i=(r=this.source,a.delimited?/(\/)$/.test(r)?r:r+"(\\/|\\?|\\.|;|$)":r),o=this.urlTest(e,i,a);if(!o)return o;if(!this.hasQueryParams)return o;var u=O(e,a.queryParams);return Object.keys(u).filter(function(e){return n.isQueryParam(e)}).forEach(function(e){return function(e,t,r){void 0===r&&(r="");var n=e[t];return e[t]=void 0===n?r:Array.isArray(n)?n.concat(r):[n,r],e}(o,e,u[e])}),o},t.prototype.build=function(a,e){var i=this;void 0===a&&(a={});var t=c({ignoreConstraints:!1,ignoreSearch:!1,queryParams:{}},e),r=Object.keys(a).filter(function(e){return!i.isQueryParam(e)}).reduce(function(e,t){if(!h(a[t]))return e;var r=a[t],n=i.isQueryParam(t)?p:encodeURI;return"boolean"==typeof r?e[t]=r:Array.isArray(r)?e[t]=r.map(n):e[t]=n(r),e},{});if(this.urlParams.some(function(e){return!h(a[e])})){var n=this.urlParams.filter(function(e){return!h(a[e])});throw new Error("Cannot build path: '"+this.path+"' requires missing parameters { "+n.join(", ")+" }")}if(!t.ignoreConstraints&&!this.tokens.filter(function(e){return/^url-parameter/.test(e.type)&&!/-splat$/.test(e.type)}).every(function(e){return new RegExp("^"+l(e.otherVal[0])+"$").test(r[e.val])}))throw new Error("Some parameters of '"+this.path+"' are of invalid format");var o=this.tokens.filter(function(e){return!1===/^query-parameter/.test(e.type)}).map(function(e){return"url-parameter-matrix"===e.type?";"+e.val+"="+r[e.val[0]]:/^url-parameter/.test(e.type)?r[e.val[0]]:e.match}).join("");if(t.ignoreSearch)return o;var u=this.queryParams.filter(function(e){return-1!==Object.keys(a).indexOf(e)}).reduce(function(e,t){return e[t]=a[t],e},{}),s=m(u,t.queryParams);return s?o+"?"+s:o},t.prototype.getParams=function(t){var e=t instanceof RegExp?function(e){return t.test(e.type)}:function(e){return e.type===t};return this.tokens.filter(e).map(function(e){return e.val[0]})},t.prototype.urlTest=function(e,t,r){var n=this,a=(void 0===r?{}:r).caseSensitive,i=new RegExp("^"+t,void 0!==a&&a?"":"i"),o=e.match(i);return o?this.urlParams.length?o.slice(1,this.urlParams.length+1).reduce(function(e,t,r){return e[n.urlParams[r]]=decodeURIComponent(t),e},{}):{}:null},t}(),v=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},g=function(e){var a="";return e.reduce(function(e,t){var r=t.parser.urlParams.reduce(function(e,t){return e[t]="url",e},{}),n=t.parser.queryParams.reduce(function(e,t){return e[t]="query",e},r);return void 0!==t.name&&(e[a=a?a+"."+t.name:t.name]=n),e},{})},P=function(e,c,l,f,d){void 0===f&&(f={});for(var t=f.queryParamsMode,p=void 0===t?"default":t,r=f.strictTrailingSlash,h=void 0!==r&&r,n=f.strongMatching,m=void 0===n||n,a=f.caseSensitive,v=void 0!==a&&a,g=1===e.length&&""===e[0].name,i=function(e){var t,r,n=void 0,a=c;if("/"===d&&"/"===e.path&&(a="/"+c),e.children.length||(t=e.parser.test(a,{caseSensitive:v,strictTrailingSlash:h,queryParams:f.queryParams})),t||(t=e.parser.partialTest(a,{delimited:m,caseSensitive:v,queryParams:f.queryParams})),t){var i=e.parser.build(t,{ignoreSearch:!0});h||e.children.length||(i=i.replace(/\/$/,"")),n=0===a.toLowerCase().indexOf(i.toLowerCase())?a.slice(i.length):a,h||e.children.length||(n=n.replace(/^\/\?/,"?"));var o=function(e,o,t){var r=y(t);if(""===T(e))return{querystring:"",removedParams:{}};var n=e.split("&").reduce(function(e,t){var r=e[0],n=e[1],a=t.split("=")[0],i=S(a).name;return-1===o.indexOf(i)?[r.concat(t),n]:[r,n.concat(t)]},[[],[]]),a=n[0],i=n[1];return{querystring:a.join("&"),removedParams:O(i.join("&"),r)}}((r=a.replace(i,""),r.split("?")[1]||""),e.parser.queryParams,f.queryParams).querystring;if(n=n.split("?")[0]+(o?"?"+o:""),h||g||"/"!==n||/\/$/.test(i)||(n=""),l.segments.push(e),Object.keys(t).forEach(function(e){return l.params[e]=t[e]}),!g&&!n.length)return{value:l};if(!g&&"strict"!==p&&0===n.indexOf("?")){var u=O(n.slice(1),f.queryParams);return Object.keys(u).forEach(function(e){return l.params[e]=u[e]}),{value:l}}var s=e.getNonAbsoluteChildren();return s.length?{value:P(s,n,l,f,i)}:{value:null}}},o=0,u=e;o<u.length;o++){var s=i(u[o]);if("object"==typeof s)return s.value}return null};v({},{queryParamsMode:"default",trailingSlashMode:"default"},{strongMatching:!0});var E=function(){function o(e,t,r,n,a,i,o){return void 0===e&&(e=""),void 0===t&&(t=""),void 0===r&&(r=[]),void 0===i&&(i=!0),this.name=e,this.absolute=/^~/.test(t),this.path=this.absolute?t.slice(1):t,this.parser=this.path?new s(this.path):null,this.children=[],this.parent=a,this.checkParents(),this.add(r,n,!i&&!1!==o),i&&this.sortDescendants(),this}return o.prototype.getParentSegments=function(e){return void 0===e&&(e=[]),this.parent&&this.parent.parser?this.parent.getParentSegments(e.concat(this.parent)):e.reverse()},o.prototype.setParent=function(e){this.parent=e,this.checkParents()},o.prototype.setPath=function(e){void 0===e&&(e=""),this.path=e,this.parser=e?new s(e):null},o.prototype.add=function(e,t,r){var n=this;if(void 0===r&&(r=!0),null!=e){if(!(e instanceof Array)){if(!(e instanceof o||e instanceof Object))throw new Error("RouteNode.add() expects routes to be an Object or an instance of RouteNode.");if(e instanceof o)e.setParent(this),this.addRouteNode(e,r);else{if(!e.name||!e.path)throw new Error("RouteNode.add() expects routes to have a name and a path defined.");var a=new o(e.name,e.path,e.children,t,this,!1,r),i=a.getParentSegments([a]).map(function(e){return e.name}).join(".");t&&t(v({},e,{name:i})),this.addRouteNode(a,r)}return this}e.forEach(function(e){return n.add(e,t,r)})}},o.prototype.addNode=function(e,t){return this.add(new o(e,t)),this},o.prototype.getPath=function(e){return(t=this.getSegmentsByName(e))?t.map(function(e){return e.path}).join(""):null;var t},o.prototype.getNonAbsoluteChildren=function(){return this.children.filter(function(e){return!e.absolute})},o.prototype.sortChildren=function(){var e,l,t;this.children.length&&(e=this.children,t=e.slice(0),e.sort((l=t,function(e,t){var r=e.path.replace(/<.*?>/g,"").split("?")[0].replace(/(.+)\/$/,"$1"),n=t.path.replace(/<.*?>/g,"").split("?")[0].replace(/(.+)\/$/,"$1");if("/"===r)return 1;if("/"===n)return-1;if(e.parser.hasSpatParam)return 1;if(t.parser.hasSpatParam)return-1;var a=(r.match(/\//g)||[]).length,i=(n.match(/\//g)||[]).length;if(a<i)return 1;if(i<a)return-1;var o=e.parser.urlParams.length,u=t.parser.urlParams.length;if(o<u)return-1;if(u<o)return 1;var s=(r.split("/").slice(-1)[0]||"").length,c=(n.split("/").slice(-1)[0]||"").length;return s<c?1:c<s?-1:l.indexOf(e)-l.indexOf(t)})))},o.prototype.sortDescendants=function(){this.sortChildren(),this.children.forEach(function(e){return e.sortDescendants()})},o.prototype.buildPath=function(e,t,r){return void 0===t&&(t={}),void 0===r&&(r={}),function(e,n,a){if(void 0===n&&(n={}),void 0===a&&(a={}),!e)return null;for(var t=a.queryParamsMode,r=void 0===t?"default":t,i=(a.trailingSlashMode,[]),o=[],u=0,s=e;u<s.length;u++){var c=s[u].parser;i.push.apply(i,c.queryParams),o.push.apply(o,c.urlParams),o.push.apply(o,c.spatParams)}if("loose"===r){var l=Object.keys(n).reduce(function(e,t){return-1===i.indexOf(t)&&-1===o.indexOf(t)?e.concat(t):e},[]);i.push.apply(i,l)}var f=i.reduce(function(e,t){return-1!==Object.keys(n).indexOf(t)&&(e[t]=n[t]),e},{}),d=m(f,a.queryParams),p=e.reduce(function(e,t){var r=t.parser.build(n,{ignoreSearch:!0,queryParams:a.queryParams});return t.absolute?r:e+r},"").replace(/\/\/{1,}/g,"/"),h=p;return"always"===a.trailingSlashMode?h=/\/$/.test(p)?p:p+"/":"never"===a.trailingSlashMode&&"/"!==p&&(h=/\/$/.test(p)?p.slice(0,-1):p),h+(d?"?"+d:"")}(this.getSegmentsByName(e),t,r)},o.prototype.buildState=function(e,t){void 0===t&&(t={});var r=this.getSegmentsByName(e);return r&&r.length?{name:e,params:t,meta:g(r)}:null},o.prototype.matchPath=function(e,t){void 0===t&&(t={}),""!==e||t.strictTrailingSlash||(e="/");var r,n=this.getSegmentsMatchingPath(e,t);if(n){var a=n.segments;if(a[0].absolute){var i=a[0].getParentSegments();a.reverse(),a.push.apply(a,i),a.reverse()}var o=a[a.length-1].findSlashChild();o&&a.push(o)}return(r=n)&&r.segments&&r.segments.length?{name:r.segments.map(function(e){return e.name}).filter(function(e){return e}).join("."),params:r.params,meta:g(r.segments)}:null},o.prototype.addRouteNode=function(e,t){void 0===t&&(t=!0);var r=e.name.split(".");if(1===r.length){if(-1!==this.children.map(function(e){return e.name}).indexOf(e.name))throw new Error('Alias "'+e.name+'" is already defined in route node');if(-1!==this.children.map(function(e){return e.path}).indexOf(e.path))throw new Error('Path "'+e.path+'" is already defined in route node');this.children.push(e),t&&this.sortChildren()}else{var n=this.getSegmentsByName(r.slice(0,-1).join("."));if(!n)throw new Error("Could not add route named '"+e.name+"', parent is missing.");e.name=r[r.length-1],n[n.length-1].add(e)}return this},o.prototype.checkParents=function(){if(this.absolute&&this.hasParentsParams())throw new Error("[RouteNode] A RouteNode with an abolute path cannot have parents with route parameters")},o.prototype.hasParentsParams=function(){if(this.parent&&this.parent.parser){var e=this.parent.parser;return e.hasUrlParams||e.hasSpatParam||e.hasMatrixParams||e.hasQueryParams||this.parent.hasParentsParams()}return!1},o.prototype.findAbsoluteChildren=function(){return this.children.reduce(function(e,t){return e.concat(t.absolute?t:[]).concat(t.findAbsoluteChildren())},[])},o.prototype.findSlashChild=function(){return this.getNonAbsoluteChildren().filter(function(e){return e.parser&&/^\/(\?|$)/.test(e.parser.path)})[0]},o.prototype.getSegmentsByName=function(e){var a=[],i=this.parser?[this]:this.children;return(this.parser?[""]:[]).concat(e.split(".")).every(function(e){var t,r,n=(t=e,(r=i.filter(function(e){return e.name===t})).length?r[0]:void 0);return!!n&&(i=n.children,a.push(n),!0)})?a:null},o.prototype.getSegmentsMatchingPath=function(e,t){var r=(this.parser?[this]:this.children).reduce(function(e,t){return e.concat(t,t.findAbsoluteChildren())},[]),n=P(r,e,{segments:[],params:{}},t);return n&&1===n.segments.length&&""===n.segments[0].name?null:n},o}(),w={ROUTER_NOT_STARTED:"NOT_STARTED",NO_START_PATH_OR_STATE:"NO_START_PATH_OR_STATE",ROUTER_ALREADY_STARTED:"ALREADY_STARTED",ROUTE_NOT_FOUND:"ROUTE_NOT_FOUND",SAME_STATES:"SAME_STATES",CANNOT_DEACTIVATE:"CANNOT_DEACTIVATE",CANNOT_ACTIVATE:"CANNOT_ACTIVATE",TRANSITION_ERR:"TRANSITION_ERR",TRANSITION_CANCELLED:"CANCELLED"},C={UNKNOWN_ROUTE:"@@router5/UNKNOWN_ROUTE",ROUTER_START:"$start",ROUTER_STOP:"$stop",TRANSITION_START:"$$start",TRANSITION_CANCEL:"$$cancel",TRANSITION_SUCCESS:"$$success",TRANSITION_ERROR:"$$error"};function R(o){var i=0,t=null;return o.getState=function(){return t},o.setState=function(e){t=e},o.makeState=function(e,t,r,n,a){return{name:e,params:_({},o.config.defaultParams[e],t),path:r,meta:n?_({},n,{id:void 0===a?++i:a}):void 0}},o.makeNotFoundState=function(e,t){return o.makeState(C.UNKNOWN_ROUTE,{path:e},e,{options:t})},o.areStatesEqual=function(t,r,e){if(void 0===e&&(e=!0),t.name!==r.name)return!1;var n=function(e){return o.rootNode.getSegmentsByName(e).map(function(e){return e.parser.urlParams}).reduce(function(e,t){return e.concat(t)},[])},a=e?n(t.name):Object.keys(t.params),i=e?n(r.name):Object.keys(r.params);return a.length===i.length&&a.every(function(e){return t.params[e]===r.params[e]})},o.areStatesDescendants=function(t,r){return!!new RegExp("^"+t.name+"\\.(.*)$").test(r.name)&&Object.keys(t.params).every(function(e){return t.params[e]===r.params[e]})},o.forwardState=function(e,t){var r=o.config.forwardMap[e]||e;return{name:r,params:_({},o.config.defaultParams[e],o.config.defaultParams[r],t)}},o.buildState=function(e,t){var r=o.forwardState(e,t),n=r.name,a=r.params;return o.rootNode.buildState(n,a)},o}var r,o={onStart:C.ROUTER_START,onStop:C.ROUTER_STOP,onTransitionSuccess:C.TRANSITION_SUCCESS,onTransitionStart:C.TRANSITION_START,onTransitionError:C.TRANSITION_ERROR,onTransitionCancel:C.TRANSITION_CANCEL};function N(a){var i=[];return a.getPlugins=function(){return i},a.usePlugin=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e.map(function(e){return i.push(e),t=e,r=a.executeFactory(t),n=Object.keys(o).map(function(e){if(r[e])return a.addEventListener(o[e],r[e])}).filter(Boolean),function(){n.forEach(function(e){return e()}),t.teardown&&t.teardown()};var t,r,n});return function(){r.forEach(function(e){return e()})}},a}function A(r){var n=[],a=[];return r.useMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.forEach(function(e){n.push(e),a.push(r.executeFactory(e))}),r},r.clearMiddleware=function(){return n=[],a=[],r},r.getMiddlewareFactories=function(){return n},r.getMiddlewareFunctions=function(){return a},r}r="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof module?module:Function("return this")();var i,b,k=("function"==typeof(b=r.Symbol)?b.observable?i=b.observable:(i=b("observable"),b.observable=i):i="@@observable",i);function j(a){var n={};function t(e){var t="object"==typeof e,r=t?e.next.bind(e):e,n=a.addEventListener(C.TRANSITION_SUCCESS,function(e,t){r({route:e,previousRoute:t})});return t?{unsubscribe:n}:n}function e(){var e;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new TypeError("Expected the observer to be an object.");return t(e)}})[k]=function(){return this},e}return a.invokeEventListeners=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];(n[e]||[]).forEach(function(e){return e.apply(void 0,t)})},a.removeEventListener=function(e,t){n[e]=n[e].filter(function(e){return e!==t})},a.addEventListener=function(e,t){return n[e]=(n[e]||[]).concat(t),function(){return a.removeEventListener(e,t)}},a.subscribe=t,a[k]=e,a["@@observable"]=e,a}var I=function(e){return e.split(".").reduce(function(e,t){return e.concat(e.length?e[e.length-1]+"."+t:t)},[])},x=function(e){return e&&e.meta&&e.meta.params},q=function(e,r){return x(r)&&null!=r.meta.params[e]?Object.keys(r.meta.params[e]).reduce(function(e,t){return e[t]=r.params[t],e},{}):{}};function U(i,o){var e,u=o?I(o.name):[],s=I(i.name),r=Math.min(u.length,s.length);e=o&&(x(o)||x(i))?function(){var a,e=function(){var e=u[a],t=s[a];if(e!==t)return{value:a};var r=q(e,i),n=q(t,o);return Object.keys(r).length!==Object.keys(n).length?{value:a}:0===Object.keys(r).length?"continue":Object.keys(r).some(function(e){return n[e]!==r[e]})?{value:a}:void 0};for(a=0;a<r;a+=1){var t=e();if("object"==typeof t)return t.value}return a}():0;var t=u.slice(e).reverse(),n=s.slice(e);return{intersection:o&&0<e?u[e-1]:"",toDeactivate:t,toActivate:n}}function D(o,e,u){var s=e.isCancelled,t=e.toState,a=e.fromState,r=e.errorKey,c=void 0===r?void 0:r,l=Array.isArray(o)?o:Object.keys(o),f=function(e){return"object"==typeof e&&void 0!==e.name&&void 0!==e.params&&void 0!==e.path},d=function(e,t,o,u){var r=function(e,t){var r,n,a,i;e?u(e):t&&t!==o&&f(t)?(a=t,((i=o).name!==a.name||i.params!==a.params||i.path!==a.path)&&console.error("[router5][transition] Warning: state values (name, params, path) were changed during transition process."),u(null,_({},n=o,r=t,{meta:_({},n.meta,r.meta)}))):u(null,o)},n=e.call(null,o,a,r);s()?r(null):"boolean"==typeof n?r(n?null:t):f(n)?r(null,n):n&&"function"==typeof n.then&&n.then(function(e){e instanceof Error?r({error:e},null):r(null,e)},function(e){e instanceof Error?(console.error(e.stack||e),r(_({},t,{promiseError:e}),null)):r("object"==typeof e?_({},t,e):t,null)})},p=function(e,t){var r;if(s())u();else if(e)u(e);else if(l.length){var n="string"==typeof l[0],a=c&&n?((r={})[c]=l[0],r):{},i=n?o[l[0]]:l[0];l=l.slice(1),d(i,a,t,p)}else u(null,t)};p(null,t)}var F=function(e,t){};function M(A){var b;function d(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[0],n=e[e.length-1],a="function"==typeof n?n:F,i="object"==typeof e[1]?e[1]:{},o="object"==typeof e[2]?e[2]:{};if(A.isStarted()){var u=A.buildState(r,i);if(!u){var s={code:w.ROUTE_NOT_FOUND};return a(s),void A.invokeEventListeners(C.TRANSITION_ERROR,null,A.getState(),s)}var c=A.makeState(u.name,u.params,A.buildPath(u.name,u.params),{params:u.meta,options:o}),l=!!A.getState()&&A.areStatesEqual(A.getState(),c,!1);if(l&&!o.reload&&!o.force){s={code:w.SAME_STATES};return a(s),void A.invokeEventListeners(C.TRANSITION_ERROR,c,A.getState(),s)}var f=l||o.reload?null:A.getState();return o.skipTransition?(a(null,c),F):A.transitionToState(c,f,o,function(e,t){if(e)if(e.redirect){var r=e.redirect;d(r.name,r.params,_({},o,{force:!0,redirected:!0}),a)}else a(e);else A.invokeEventListeners(C.TRANSITION_SUCCESS,t,f,o),a(null,t)})}a({code:w.ROUTER_NOT_STARTED})}return A.navigate=d,A.navigate=d,A.navigateToDefault=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r="object"==typeof e[0]?e[0]:{},n=2===e.length?e[1]:"function"==typeof e[0]?e[0]:F,a=A.getOptions();return a.defaultRoute?d(a.defaultRoute,a.defaultParams,r,n):function(){}},A.cancel=function(){return b&&(b("navigate"),b=null),A},A.transitionToState=function(r,n,e,a){var i,o,t,u,s,c,l,f,d,p,h,m,v,g,y,T,S,O,P,E,R,N;return void 0===e&&(e={}),void 0===a&&(a=F),A.cancel(),A.invokeEventListeners(C.TRANSITION_START,r,n),o=r,t=n,u=e,l=c=!(s=function(e,t){b=null,t=t||r,e?(e.code===w.TRANSITION_CANCELLED?A.invokeEventListeners(C.TRANSITION_CANCEL,r,n):A.invokeEventListeners(C.TRANSITION_ERROR,r,n,e),a(e)):(A.setState(t),a(null,t))}),f=(i=A).getOptions(),d=i.getLifecycleFunctions(),p=d[0],h=d[1],m=i.getMiddlewareFunctions(),v=function(){return c},g=function(e,t){return _({},e,t instanceof Object?t:{error:t})},y=o.name===C.UNKNOWN_ROUTE,T={isCancelled:v,toState:o,fromState:t},S=U(o,t),O=S.toDeactivate,P=S.toActivate,E=!t||u.forceDeactivate?[]:function(e,t,r){D(O.filter(function(e){return p[e]}).reduce(function(e,t){var r;return _({},e,((r={})[t]=p[t],r))},{}),_({},T,{errorKey:"segment"}),function(e){return r(e?g({code:w.CANNOT_DEACTIVATE},e):null)})},R=y?[]:function(e,t,r){D(P.filter(function(e){return h[e]}).reduce(function(e,t){var r;return _({},e,((r={})[t]=h[t],r))},{}),_({},T,{errorKey:"segment"}),function(e){return r(e?g({code:w.CANNOT_ACTIVATE},e):null)})},N=m.length?function(r,e,n){return D(m,_({},T),function(e,t){return n(e?g({code:w.TRANSITION_ERR},e):null,t||r)})}:[],D([].concat(E).concat(R).concat(N),T,function(e,t){if(l=!0,!v()){if(!e&&f.autoCleanUp){var r=I(o.name);Object.keys(p).forEach(function(e){-1===r.indexOf(e)&&i.clearCanDeactivate(e)})}s(e,t||o)}}),b=function(){c||l||(c=!0,s({code:w.TRANSITION_CANCELLED},null))}},A}var L=function(){};function $(f){var d=!1;return f.isStarted=function(){return d},f.start=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r,n,a=f.getOptions(),i=e[e.length-1],o="function"==typeof i?i:L,u="function"!=typeof e[0]?e[0]:void 0;if(d)return o({code:w.ROUTER_ALREADY_STARTED}),f;d=!0,f.invokeEventListeners(C.ROUTER_START);var s=function(e,t,r){void 0===r&&(r=!0),e||f.invokeEventListeners(C.TRANSITION_SUCCESS,t,null,{replace:!0}),e&&r&&f.invokeEventListeners(C.TRANSITION_ERROR,t,null,e),o(e,t)};if(void 0===u&&!a.defaultRoute)return s({code:w.NO_START_PATH_OR_STATE});if("string"==typeof u?r=u:"object"==typeof u&&(n=u),n)f.setState(n),s(null,n);else{n=void 0===r?null:f.matchPath(r);var c=function(){return f.navigateToDefault({replace:!0},o)},l=function(e){f.transitionToState(e,f.getState(),{},function(e,t){var r;e?e.redirect?(r=e.redirect,f.navigate(r.name,r.params,{replace:!0,reload:!0,redirected:!0},o)):a.defaultRoute?c():s(e,null,!1):s(null,t)})};n?l(n):a.defaultRoute?c():a.allowNotFound?l(f.makeNotFoundState(r,{replace:!0})):s({code:w.ROUTE_NOT_FOUND,path:r},null)}return f},f.stop=function(){return d&&(f.setState(null),d=!1,f.invokeEventListeners(C.ROUTER_STOP)),f},f}var z=function(e){return"function"==typeof e?e:function(){return function(){return e}}};function B(n){var a={},i={},o={},u={};return n.getLifecycleFactories=function(){return[a,i]},n.getLifecycleFunctions=function(){return[o,u]},n.canDeactivate=function(e,t){var r=z(t);return a[e]=r,o[e]=n.executeFactory(r),n},n.clearCanDeactivate=function(e){return a[e]=void 0,o[e]=void 0,n},n.canActivate=function(e,t){var r=z(t);return i[e]=r,u[e]=n.executeFactory(r),n},n}var Q=function(e,t,r){var a,i,o;return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){return t.reduce(function(e,t){return t(e)},e)}}((o=t,function(r){var n=_({},u,o);return r.getOptions=function(){return n},r.setOption=function(e,t){return n[e]=t,r},r}),(i=e,function(d){d.forward=function(e,t){return d.config.forwardMap[e]=t,d};var n=i instanceof E?i:new E("","",i,r);function r(e){e.canActivate&&d.canActivate(e.name,e.canActivate),e.forwardTo&&d.forward(e.name,e.forwardTo),e.decodeParams&&(d.config.decoders[e.name]=e.decodeParams),e.encodeParams&&(d.config.encoders[e.name]=e.encodeParams),e.defaultParams&&(d.config.defaultParams[e.name]=e.defaultParams)}return d.rootNode=n,d.add=function(e,t){return n.add(e,r,!t),t&&n.sortDescendants(),d},d.addNode=function(e,t,r){return n.addNode(e,t),r&&d.canActivate(e,r),d},d.isActive=function(e,t,r,n){void 0===t&&(t={}),void 0===r&&(r=!1),void 0===n&&(n=!0);var a=d.getState();return!!a&&(r||a.name===e?d.areStatesEqual(d.makeState(e,t),a,n):d.areStatesDescendants(d.makeState(e,t),a))},d.buildPath=function(e,t){if(e===C.UNKNOWN_ROUTE)return t.path;var r=_({},d.config.defaultParams[e],t),n=d.getOptions(),a=n.trailingSlashMode,i=n.queryParamsMode,o=n.queryParams,u=d.config.encoders[e]?d.config.encoders[e](r):r;return d.rootNode.buildPath(e,u,{trailingSlashMode:a,queryParamsMode:i,queryParams:o})},d.matchPath=function(e,t){var r=d.getOptions(),n=d.rootNode.matchPath(e,r);if(n){var a=n.name,i=n.params,o=n.meta,u=d.config.decoders[a]?d.config.decoders[a](i):i,s=d.forwardState(a,u),c=s.name,l=s.params,f=!1===r.rewritePathOnMatch?e:d.buildPath(c,l);return d.makeState(c,l,f,{params:o,source:t})}return null},d.setRootPath=function(e){d.rootNode.setPath(e)},d}),(a=r,function(r){var n=a;return r.setDependency=function(e,t){return n[e]=t,r},r.setDependencies=function(t){return Object.keys(t).forEach(function(e){return r.setDependency(e,t[e])}),r},r.getDependencies=function(){return n},r.getInjectables=function(){return[r,r.getDependencies()]},r.executeFactory=function(e){return e.apply(void 0,r.getInjectables())},r}),j,R,$,B,M,N,A)({config:{decoders:{},encoders:{},defaultParams:{},forwardMap:{}}})};e.createRouter=Q,e.cloneRouter=function(e,t){var r=Q(e.rootNode,e.getOptions(),t);r.useMiddleware.apply(r,e.getMiddlewareFactories()),r.usePlugin.apply(r,e.getPlugins()),r.config=e.config;var n=e.getLifecycleFactories(),a=n[0],i=n[1];return Object.keys(a).forEach(function(e){return r.canDeactivate(e,a[e])}),Object.keys(i).forEach(function(e){return r.canActivate(e,i[e])}),r},e.RouteNode=E,e.transitionPath=U,e.constants=C,e.errorCodes=w,e.default=Q,Object.defineProperty(e,"__esModule",{value:!0})});
